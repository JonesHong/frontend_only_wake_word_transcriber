# Software Requirements Specification (SRS)

## 1. Introduction

### 1.1 Purpose

本文件描述一個純前端語音助理應用的功能與非功能需求，並定義系統架構、狀態流程與使用者介面。該應用使用 HTML、JavaScript 與 CSS 實現，提供喚醒詞偵測、語音活動偵測（VAD）與語音轉譯等功能。

### 1.2 範圍

該應用運行於瀏覽器端，無後端依賴，主要功能包括：

* 喚醒詞模型的載入與替換
* 錄音流程控制（開始／結束）
* VAD 與語音轉譯
* 音波、喚醒詞與 VAD 狀態可視化
* 每段錄音轉譯結果展示

### 1.3 定義與縮寫

* **ONNX**: Open Neural Network Exchange
* **VAD**: Voice Activity Detection
* **UI**: User Interface
* **FSM**: Finite State Machine

## 2. 整體描述

### 2.1 系統視角

此應用為單頁純前端，UI 與邏輯皆在瀏覽器執行，並使用 Web Speech API 進行語音轉譯，喚醒詞模型以 ONNX 格式載入並透過 WebAssembly 或相關 JS 套件推論。

### 2.2 使用者需求

1. 使用者可按鈕控制錄音流程。
2. 預設載入 `@models/hi_kmu_0721.onnx`，並可上傳替換模型。
3. 實時顯示麥克風音波、喚醒詞偵測分數圖表、VAD 狀態。
4. 每次啟動聆聽到停頓間隔後，顯示語音轉譯結果。

## 3. 系統功能需求

### 3.1 功能需求

#### 3.1.1 錄音控制

* **開始按鈕**: 觸發錄音初始化，進入 `Idle` 狀態並啟用喚醒詞偵測。
* **停止按鈕**: 任意狀態下觸發，停止錄音並回到 `Initialization` 狀態，重置所有計時與偵測。

#### 3.1.2 喚醒詞偵測

* 系統會載入 `@models/hi_kmu_0721.onnx` 模型。
* UI 提供上傳按鈕，允許使用者上傳自訂 ONNX 喚醒詞模型，替換預設模型。

#### 3.1.3  VAD 與語音轉譯

* 進入 `Listening` 狀態時，同時啟用 VAD 與 3 秒靜音計時器。
* 偵測到人聲 (VAD) 時，重置靜音計時器，並將音訊片段傳遞至 Web Speech API 進行轉譯。
* 遇到連續 3 秒靜音後，狀態切換回 `Idle`，重新啟用喚醒詞偵測。

#### 3.1.4 可視化元件

* **麥克風音波圖**: 顯示即時音波線條圖。
* **喚醒詞偵測圖表**: 顯示關鍵字相似度或偵測分數。
* **VAD 狀態指示**: 實時顯示是否偵測到人聲。
* **轉譯結果列表**: 每段錄音結束後，顯示對應的文字結果。

#### 3.1.5 資料結構與檔案組織

* 模型放置於 `@models/` 資料夾下。
* 預設喚醒詞模型 `@models/hi_kmu_0721.onnx`。
* 範例程式碼存放於 `@example/`，包含 `vad_script_tags`、`open_wake_word_web`、`web_speech_api` 檔案或模組。

## 4. 有限狀態機 (FSM)

### 4.1 狀態定義

1. **Initialization**: 系統啟動或停止錄音後的初始狀態。
2. **Idle**: 等待喚醒詞觸發，僅執行模型推論與分數更新。
3. **Listening**: 喚醒詞觸發後，暫停喚醒詞偵測，啟動 VAD 與計時器。

### 4.2 狀態轉換

* **Initialization → Idle**: 按下「開始收音」按鈕。
* **Idle → Listening**: 模型偵測到喚醒詞。
* **Listening → Idle**: 連續 3 秒無人聲偵測。
* **任何狀態 → Initialization**: 按下「停止收音」按鈕。

## 5. 介面需求

### 5.1 使用者介面 (UI)

* **按鈕**: 「開始收音」、「停止收音」、「上傳模型」。
* **圖表區域**: 音波圖、喚醒詞分數圖、VAD 狀態燈。
* **結果區域**: 每段錄音的文字轉譯結果列表。

### 5.2 軟體介面

* **Web Speech API**: 用於語音轉譯。
* **ONNX Runtime (WASM/JS)**: 用於載入與執行喚醒詞模型。
* **VAD Library 或 自行實作**: 判斷聲音活動。

## 6. 非功能需求

### 6.1 效能

* 喚醒詞模型推論延遲 ≤ 100 ms。
* VAD 偵測與 UI 更新延遲 ≤ 50 ms。

### 6.2 可用性

* UI 響應流暢，按鈕與圖表專區需無明顯卡頓。
* 模型替換操作簡易明確。

### 6.3 相容性

* 支援主流桌面瀏覽器 (Chrome, Firefox, Edge)。

## 7. 附件

* 範例程式目錄: `@example/`
* 相關模組: `vad_script_tags.js`, `open_wake_word_web.js`, `web_speech_api.js`
