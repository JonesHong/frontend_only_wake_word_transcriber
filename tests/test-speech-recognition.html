<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Recognition Manager æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .pulse-animation {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 max-w-6xl">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                ğŸ™ï¸ Speech Recognition Manager æ¸¬è©¦
            </h1>
            <p class="text-gray-600">æ¸¬è©¦é›™æ¨¡å¼èªéŸ³è­˜åˆ¥ç³»çµ±ï¼ˆWeb Speech API / Whisperï¼‰</p>
        </div>

        <!-- ç‹€æ…‹é¢æ¿ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- ç³»çµ±ç‹€æ…‹ -->
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-sm font-semibold text-gray-500 mb-2">ç³»çµ±ç‹€æ…‹</h3>
                <div id="systemStatus" class="space-y-1">
                    <div class="flex justify-between">
                        <span class="text-sm">ç®¡ç†å™¨</span>
                        <span id="managerStatus" class="text-sm font-medium text-gray-400">æœªåˆå§‹åŒ–</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">ç•¶å‰æ¨¡å¼</span>
                        <span id="currentMode" class="text-sm font-medium text-gray-400">ç„¡</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">è­˜åˆ¥ç‹€æ…‹</span>
                        <span id="recognitionStatus" class="text-sm font-medium text-gray-400">é–’ç½®</span>
                    </div>
                </div>
            </div>

            <!-- å¯ç”¨å¼•æ“ -->
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-sm font-semibold text-gray-500 mb-2">å¯ç”¨å¼•æ“</h3>
                <div id="availableEngines" class="space-y-1">
                    <div class="text-sm text-gray-400">æª¢æ¸¬ä¸­...</div>
                </div>
            </div>

            <!-- æ•ˆèƒ½æŒ‡æ¨™ -->
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-sm font-semibold text-gray-500 mb-2">æ•ˆèƒ½æŒ‡æ¨™</h3>
                <div class="space-y-1">
                    <div class="flex justify-between">
                        <span class="text-sm">å»¶é²</span>
                        <span id="latency" class="text-sm font-medium text-gray-400">-- ms</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">è™•ç†æ™‚é–“</span>
                        <span id="processingTime" class="text-sm font-medium text-gray-400">-- ms</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm">ä¿¡å¿ƒåº¦</span>
                        <span id="confidence" class="text-sm font-medium text-gray-400">--%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-lg font-semibold mb-4">æ§åˆ¶é¢æ¿</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- åŸºæœ¬æ§åˆ¶ -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ¨¡å¼é¸æ“‡</label>
                        <div class="flex gap-2">
                            <button id="autoMode" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">
                                è‡ªå‹•
                            </button>
                            <button id="webSpeechMode" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">
                                Web Speech
                            </button>
                            <button id="whisperMode" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">
                                Whisper
                            </button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">èªè¨€è¨­å®š</label>
                        <select id="languageSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="zh-TW">ä¸­æ–‡ï¼ˆè‡ºç£ï¼‰</option>
                            <option value="zh-CN">ä¸­æ–‡ï¼ˆä¸­å›½ï¼‰</option>
                            <option value="en-US">English (US)</option>
                            <option value="ja-JP">æ—¥æœ¬èª</option>
                            <option value="ko-KR">í•œêµ­ì–´</option>
                        </select>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰éˆ• -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">å³æ™‚è­˜åˆ¥</label>
                        <div class="flex gap-2">
                            <button id="startBtn" class="px-6 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition">
                                é–‹å§‹è­˜åˆ¥
                            </button>
                            <button id="stopBtn" class="px-6 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition" disabled>
                                åœæ­¢è­˜åˆ¥
                            </button>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æª”æ¡ˆè½‰è­¯</label>
                        <input type="file" id="fileInput" accept="audio/*" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                </div>
            </div>
        </div>

        <!-- è­˜åˆ¥çµæœ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- å³æ™‚çµæœ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-3">å³æ™‚è­˜åˆ¥çµæœ</h3>
                <div class="space-y-2">
                    <div>
                        <label class="text-sm text-gray-500">è‡¨æ™‚çµæœï¼š</label>
                        <div id="interimResult" class="mt-1 p-3 bg-gray-50 rounded min-h-[60px] text-gray-600 italic">
                            ç­‰å¾…è¼¸å…¥...
                        </div>
                    </div>
                    <div>
                        <label class="text-sm text-gray-500">æœ€çµ‚çµæœï¼š</label>
                        <div id="finalResult" class="mt-1 p-3 bg-blue-50 rounded min-h-[100px] text-gray-800">
                            ç­‰å¾…è­˜åˆ¥...
                        </div>
                    </div>
                </div>
            </div>

            <!-- æª”æ¡ˆè½‰è­¯çµæœ -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-3">æª”æ¡ˆè½‰è­¯çµæœ</h3>
                <div id="fileTranscription" class="p-3 bg-gray-50 rounded min-h-[180px] text-gray-700">
                    <div class="text-gray-400">è«‹é¸æ“‡éŸ³è¨Šæª”æ¡ˆé€²è¡Œè½‰è­¯...</div>
                </div>
                <div id="transcriptionProgress" class="mt-3 hidden">
                    <div class="flex justify-between text-sm mb-1">
                        <span>è½‰è­¯é€²åº¦</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progressBar" class="bg-blue-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- äº‹ä»¶æ—¥èªŒ -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-semibold">äº‹ä»¶æ—¥èªŒ</h3>
                <button id="clearLog" class="px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">
                    æ¸…é™¤æ—¥èªŒ
                </button>
            </div>
            <div id="eventLog" class="h-48 overflow-y-auto bg-gray-900 text-green-400 p-3 rounded font-mono text-sm">
                <div class="text-gray-500">ç³»çµ±æº–å‚™ä¸­...</div>
            </div>
        </div>

        <!-- æ¸¬è©¦æ¡ˆä¾‹ -->
        <div class="mt-6 bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold mb-3">å¿«é€Ÿæ¸¬è©¦</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button class="test-case px-3 py-2 bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition" data-test="webSpeechBasic">
                    Web Speech åŸºæœ¬æ¸¬è©¦
                </button>
                <button class="test-case px-3 py-2 bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition" data-test="modeSwitch">
                    æ¨¡å¼åˆ‡æ›æ¸¬è©¦
                </button>
                <button class="test-case px-3 py-2 bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition" data-test="errorRecovery">
                    éŒ¯èª¤æ¢å¾©æ¸¬è©¦
                </button>
                <button class="test-case px-3 py-2 bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition" data-test="whisperLoad">
                    Whisper è¼‰å…¥æ¸¬è©¦
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script type="module">
        import { getSpeechRecognitionManager } from './js/modules/speech-recognition-manager.js';

        // å…¨åŸŸè®Šæ•¸
        let manager = null;
        let isRecognizing = false;
        let startTime = null;
        let isTranscribing = false;
        let transcriptionText = '';  // ç´¯ç©çš„è½‰è­¯æ–‡æœ¬

        // DOM å…ƒç´ 
        const elements = {
            // ç‹€æ…‹å…ƒç´ 
            managerStatus: document.getElementById('managerStatus'),
            currentMode: document.getElementById('currentMode'),
            recognitionStatus: document.getElementById('recognitionStatus'),
            availableEngines: document.getElementById('availableEngines'),
            latency: document.getElementById('latency'),
            processingTime: document.getElementById('processingTime'),
            confidence: document.getElementById('confidence'),
            
            // æ§åˆ¶å…ƒç´ 
            startBtn: document.getElementById('startBtn'),
            stopBtn: document.getElementById('stopBtn'),
            autoMode: document.getElementById('autoMode'),
            webSpeechMode: document.getElementById('webSpeechMode'),
            whisperMode: document.getElementById('whisperMode'),
            languageSelect: document.getElementById('languageSelect'),
            fileInput: document.getElementById('fileInput'),
            
            // çµæœå…ƒç´ 
            interimResult: document.getElementById('interimResult'),
            finalResult: document.getElementById('finalResult'),
            fileTranscription: document.getElementById('fileTranscription'),
            transcriptionProgress: document.getElementById('transcriptionProgress'),
            progressText: document.getElementById('progressText'),
            progressBar: document.getElementById('progressBar'),
            
            // æ—¥èªŒ
            eventLog: document.getElementById('eventLog'),
            clearLog: document.getElementById('clearLog')
        };

        // æ—¥èªŒåŠŸèƒ½
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'fade-in';
            
            const colors = {
                info: 'text-green-400',
                warn: 'text-yellow-400',
                error: 'text-red-400',
                success: 'text-blue-400'
            };
            
            logEntry.className += ' ' + (colors[type] || colors.info);
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            elements.eventLog.appendChild(logEntry);
            elements.eventLog.scrollTop = elements.eventLog.scrollHeight;
        }

        // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
        function updateStatus() {
            if (!manager) return;
            
            const status = manager.getStatus();
            
            elements.managerStatus.textContent = status.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–';
            elements.managerStatus.className = `text-sm font-medium ${status.isInitialized ? 'text-green-600' : 'text-gray-400'}`;
            
            elements.currentMode.textContent = status.currentMode || 'ç„¡';
            elements.currentMode.className = `text-sm font-medium ${status.currentMode ? 'text-blue-600' : 'text-gray-400'}`;
            
            elements.recognitionStatus.textContent = status.isActive ? 'è­˜åˆ¥ä¸­' : 'é–’ç½®';
            elements.recognitionStatus.className = `text-sm font-medium ${status.isActive ? 'text-green-600 pulse-animation' : 'text-gray-400'}`;
            
            // æ›´æ–°å¯ç”¨å¼•æ“åˆ—è¡¨
            if (status.availableEngines.length > 0) {
                elements.availableEngines.innerHTML = status.availableEngines.map(engine => `
                    <div class="flex items-center justify-between py-1">
                        <span class="text-sm">${engine}</span>
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    </div>
                `).join('');
            }
        }

        // åˆå§‹åŒ–ç®¡ç†å™¨
        async function initializeManager() {
            try {
                log('æ­£åœ¨åˆå§‹åŒ– Speech Recognition Manager...');
                
                manager = getSpeechRecognitionManager({
                    defaultMode: 'auto',
                    language: 'zh-TW',
                    continuous: true,
                    interimResults: true
                });

                // è¨­å®šäº‹ä»¶ç›£è½å™¨
                manager.on('start', () => {
                    log('èªéŸ³è­˜åˆ¥å·²é–‹å§‹', 'success');
                    startTime = Date.now();
                    updateStatus();
                });

                manager.on('end', () => {
                    log('èªéŸ³è­˜åˆ¥å·²çµæŸ');
                    updateStatus();
                });

                manager.on('speechStart', () => {
                    log('æª¢æ¸¬åˆ°èªéŸ³é–‹å§‹');
                });

                manager.on('speechEnd', () => {
                    log('æª¢æ¸¬åˆ°èªéŸ³çµæŸ');
                });

                manager.on('interimResult', (data) => {
                    elements.interimResult.textContent = data.transcript;
                    
                    if (startTime) {
                        const latency = Date.now() - startTime;
                        elements.latency.textContent = `${latency} ms`;
                        elements.latency.className = `text-sm font-medium ${latency < 100 ? 'text-green-600' : latency < 200 ? 'text-yellow-600' : 'text-red-600'}`;
                    }
                });

                manager.on('result', (data) => {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'fade-in mb-2 p-2 bg-white rounded';
                    resultDiv.innerHTML = `
                        <div class="font-medium">${data.transcript}</div>
                        <div class="text-xs text-gray-500 mt-1">
                            å¼•æ“: ${data.engine} | ä¿¡å¿ƒåº¦: ${(data.confidence * 100).toFixed(1)}%
                        </div>
                    `;
                    
                    if (elements.finalResult.querySelector('.text-gray-400')) {
                        elements.finalResult.innerHTML = '';
                    }
                    elements.finalResult.appendChild(resultDiv);
                    
                    // æ›´æ–°ä¿¡å¿ƒåº¦
                    elements.confidence.textContent = `${(data.confidence * 100).toFixed(1)}%`;
                    elements.confidence.className = `text-sm font-medium ${data.confidence > 0.8 ? 'text-green-600' : data.confidence > 0.6 ? 'text-yellow-600' : 'text-red-600'}`;
                    
                    log(`è­˜åˆ¥çµæœ: "${data.transcript}" (ä¿¡å¿ƒåº¦: ${(data.confidence * 100).toFixed(1)}%)`, 'success');
                });

                manager.on('error', (error) => {
                    log(`éŒ¯èª¤: ${error.message || error}`, 'error');
                });

                manager.on('modeChanged', (data) => {
                    log(`æ¨¡å¼å·²åˆ‡æ›è‡³: ${data.mode}`, 'info');
                    updateStatus();
                    updateModeButtons(data.mode);
                });

                manager.on('loadProgress', (data) => {
                    log(`æ¨¡å‹è¼‰å…¥ä¸­: ${data.progress}% - ${data.message}`, 'info');
                    if (elements.transcriptionProgress.classList.contains('hidden')) {
                        elements.transcriptionProgress.classList.remove('hidden');
                    }
                    elements.progressText.textContent = `${data.progress}%`;
                    elements.progressBar.style.width = `${data.progress}%`;
                });

                manager.on('modelLoaded', () => {
                    log('Whisper æ¨¡å‹è¼‰å…¥å®Œæˆ', 'success');
                    setTimeout(() => {
                        elements.transcriptionProgress.classList.add('hidden');
                    }, 1000);
                });

                // åˆå§‹åŒ–
                await manager.initialize();
                
                log('Speech Recognition Manager åˆå§‹åŒ–å®Œæˆ', 'success');
                updateStatus();
                
            } catch (error) {
                log(`åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
                console.error(error);
            }
        }

        // æ›´æ–°æ¨¡å¼æŒ‰éˆ•ç‹€æ…‹
        function updateModeButtons(mode) {
            const buttons = {
                auto: elements.autoMode,
                webspeech: elements.webSpeechMode,
                whisper: elements.whisperMode
            };
            
            Object.keys(buttons).forEach(key => {
                if (key === mode || (mode === 'webspeech' && key === 'auto')) {
                    buttons[key].className = 'px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition';
                } else {
                    buttons[key].className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition';
                }
            });
        }

        // é–‹å§‹è­˜åˆ¥
        async function startRecognition() {
            if (!manager || isRecognizing) return;
            
            try {
                const language = elements.languageSelect.value;
                await manager.start({ language });
                
                isRecognizing = true;
                elements.startBtn.disabled = true;
                elements.stopBtn.disabled = false;
                
                elements.interimResult.textContent = 'è†è½ä¸­...';
                elements.finalResult.innerHTML = '<div class="text-gray-400">ç­‰å¾…èªéŸ³è¼¸å…¥...</div>';
                
            } catch (error) {
                log(`å•Ÿå‹•å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // åœæ­¢è­˜åˆ¥
        async function stopRecognition() {
            if (!manager || !isRecognizing) return;
            
            try {
                await manager.stop();
                
                isRecognizing = false;
                elements.startBtn.disabled = false;
                elements.stopBtn.disabled = true;
                
            } catch (error) {
                log(`åœæ­¢å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // åˆ‡æ›æ¨¡å¼
        async function switchMode(mode) {
            if (!manager) return;
            
            try {
                if (mode === 'auto') {
                    const detectedMode = await manager.determineMode();
                    await manager.setMode(detectedMode);
                } else {
                    await manager.switchMode(mode);
                }
            } catch (error) {
                log(`æ¨¡å¼åˆ‡æ›å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // è™•ç†æª”æ¡ˆä¸Šå‚³
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file || !manager) return;
            
            log(`é–‹å§‹è½‰è­¯æª”æ¡ˆ: ${file.name}`, 'info');
            elements.fileTranscription.innerHTML = '<div class="text-gray-500">è¼‰å…¥æ¨¡å‹ä¸­ï¼Œè«‹ç¨å€™...</div>';
            elements.transcriptionProgress.classList.remove('hidden');
            
            // é‡ç½®è½‰è­¯ç‹€æ…‹
            isTranscribing = true;
            transcriptionText = '';
            
            // è¨­å®šä¸²æµæ›´æ–°çš„äº‹ä»¶ç›£è½å™¨
            const handleStreamUpdate = (data) => {
                if (data.transcript) {
                    transcriptionText = data.transcript;
                    elements.fileTranscription.innerHTML = `
                        <div class="mb-2 text-sm text-gray-500">æª”æ¡ˆ: ${file.name}</div>
                        <div class="text-gray-800">
                            ${transcriptionText}
                            <span class="inline-block ml-1 w-2 h-4 bg-blue-500 animate-pulse"></span>
                        </div>
                    `;
                }
            };
            
            // è¨»å†Šè‡¨æ™‚çš„ä¸²æµæ›´æ–°ç›£è½å™¨
            manager.on('interimTranscription', handleStreamUpdate);
            
            try {
                const transcript = await manager.transcribeFile(file, {
                    language: elements.languageSelect.value
                });
                
                // æœ€çµ‚çµæœ
                elements.fileTranscription.innerHTML = `
                    <div class="mb-2 text-sm text-gray-500">æª”æ¡ˆ: ${file.name}</div>
                    <div class="text-gray-800">${transcript}</div>
                `;
                
                log('æª”æ¡ˆè½‰è­¯å®Œæˆ', 'success');
                
            } catch (error) {
                elements.fileTranscription.innerHTML = `
                    <div class="text-red-500">è½‰è­¯å¤±æ•—: ${error.message}</div>
                `;
                log(`æª”æ¡ˆè½‰è­¯å¤±æ•—: ${error.message}`, 'error');
            } finally {
                // æ¸…ç†
                isTranscribing = false;
                manager.off('interimTranscription', handleStreamUpdate);
                setTimeout(() => {
                    elements.transcriptionProgress.classList.add('hidden');
                }, 1000);
            }
        }

        // åŸ·è¡Œæ¸¬è©¦æ¡ˆä¾‹
        async function runTestCase(testName) {
            log(`åŸ·è¡Œæ¸¬è©¦: ${testName}`, 'info');
            
            switch(testName) {
                case 'webSpeechBasic':
                    await switchMode('webspeech');
                    await startRecognition();
                    setTimeout(() => stopRecognition(), 5000);
                    break;
                    
                case 'modeSwitch':
                    await switchMode('webspeech');
                    setTimeout(async () => {
                        await switchMode('whisper');
                        setTimeout(() => switchMode('auto'), 2000);
                    }, 2000);
                    break;
                    
                case 'errorRecovery':
                    // æ¨¡æ“¬éŒ¯èª¤æƒ…æ³
                    manager.emit('error', new Error('æ¨¡æ“¬éŒ¯èª¤'));
                    setTimeout(() => {
                        log('å˜—è©¦æ¢å¾©...', 'warn');
                        initializeManager();
                    }, 2000);
                    break;
                    
                case 'whisperLoad':
                    await switchMode('whisper');
                    log('æ­£åœ¨è¼‰å…¥ Whisper æ¨¡å‹ï¼Œé€™å¯èƒ½éœ€è¦ä¸€äº›æ™‚é–“...', 'warn');
                    break;
            }
        }

        // äº‹ä»¶ç¶å®š
        elements.startBtn.addEventListener('click', startRecognition);
        elements.stopBtn.addEventListener('click', stopRecognition);
        elements.autoMode.addEventListener('click', () => switchMode('auto'));
        elements.webSpeechMode.addEventListener('click', () => switchMode('webspeech'));
        elements.whisperMode.addEventListener('click', () => switchMode('whisper'));
        elements.fileInput.addEventListener('change', handleFileUpload);
        elements.clearLog.addEventListener('click', () => {
            elements.eventLog.innerHTML = '<div class="text-gray-500">æ—¥èªŒå·²æ¸…é™¤</div>';
        });

        // æ¸¬è©¦æ¡ˆä¾‹æŒ‰éˆ•
        document.querySelectorAll('.test-case').forEach(button => {
            button.addEventListener('click', (e) => {
                runTestCase(e.target.dataset.test);
            });
        });

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.addEventListener('load', () => {
            log('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–ç³»çµ±...');
            initializeManager();
        });

        // é é¢å¸è¼‰æ™‚æ¸…ç†
        window.addEventListener('beforeunload', async () => {
            if (manager) {
                await manager.dispose();
            }
        });
    </script>
</body>
</html>